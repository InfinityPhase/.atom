!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("fs-plus"),require("path"),require("request"),require("querystringify"),require("tmp"),require("cross-spawn"),require("sockjs-client"),require("jsonrpc-lite"),require("tcp-port-used"),require("tar"),require("zlib"),require("semver"),require("ini")):"function"==typeof define&&define.amd?define("platformio-node-helpers",["fs-plus","path","request","querystringify","tmp","cross-spawn","sockjs-client","jsonrpc-lite","tcp-port-used","tar","zlib","semver","ini"],t):"object"==typeof exports?exports["platformio-node-helpers"]=t(require("fs-plus"),require("path"),require("request"),require("querystringify"),require("tmp"),require("cross-spawn"),require("sockjs-client"),require("jsonrpc-lite"),require("tcp-port-used"),require("tar"),require("zlib"),require("semver"),require("ini")):e["platformio-node-helpers"]=t(e["fs-plus"],e.path,e.request,e.querystringify,e.tmp,e["cross-spawn"],e["sockjs-client"],e["jsonrpc-lite"],e["tcp-port-used"],e.tar,e.zlib,e.semver,e.ini)}(global,function(e,t,r,n,o,i,a,u,s,c,f,l,p){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=10)}([function(e,t,r){e.exports=r(11)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPythonExecutable=t.IS_WINDOWS=void 0;var n=l(r(0));t.getPythonExecutable=function(){var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),u=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}}(n.default.mark(function e(){var t,r,u,s,c,f,l,h,v,m,y,g,b,w,x,P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=p?["python.exe"]:["python2.7","python2","python"],r=k||[],P&&(r.push((0,o.getEnvBinDir)()),r.push((0,o.getEnvDir)())),p&&r.push(a.default.join((0,o.getHomeDir)(),"python27")),process.env.PATH.split(a.default.delimiter).forEach(function(e){r.includes(e)||r.push(e)}),u=!0,s=!1,c=void 0,e.prev=8,f=r[Symbol.iterator]();case 10:if(u=(l=f.next()).done){e.next=47;break}h=l.value,v=!0,m=!1,y=void 0,e.prev=15,g=t[Symbol.iterator]();case 17:if(v=(b=g.next()).done){e.next=30;break}if(w=b.value,x=a.default.normalize(a.default.join(h,w)).replace(/"/g,""),e.t0=i.default.isFileSync(x),!e.t0){e.next=25;break}return e.next=24,d(x);case 24:e.t0=e.sent;case 25:if(!e.t0){e.next=27;break}return e.abrupt("return",x);case 27:v=!0,e.next=17;break;case 30:e.next=36;break;case 32:e.prev=32,e.t1=e.catch(15),m=!0,y=e.t1;case 36:e.prev=36,e.prev=37,!v&&g.return&&g.return();case 39:if(e.prev=39,!m){e.next=42;break}throw y;case 42:return e.finish(39);case 43:return e.finish(36);case 44:u=!0,e.next=10;break;case 47:e.next=53;break;case 49:e.prev=49,e.t2=e.catch(8),s=!0,c=e.t2;case 53:e.prev=53,e.prev=54,!u&&f.return&&f.return();case 56:if(e.prev=56,!s){e.next=59;break}throw c;case 59:return e.finish(56);case 60:return e.finish(53);case 61:return e.abrupt("return",void 0);case 62:case"end":return e.stop()}},e,this,[[8,49,53,61],[15,32,36,44],[37,,39,43],[54,,56,60]])}));return function(){return e.apply(this,arguments)}}();t.patchOSEnviron=function(e){var t=e.caller,r=e.useBuiltinPIOCore,n=void 0===r||r,i=e.extraPath,u=e.extraVars;process.env.PLATFORMIO_CALLER=t,"darwin"===process.platform&&(process.env.LC_ALL="en_US.UTF-8");"atom"===t&&(process.env.PLATFORMIO_DISABLE_PROGRESSBAR="true");u&&Object.keys(u).forEach(function(e){return process.env[e]=u[e]});process.env.Path&&(process.env.PATH?process.env.PATH+=a.default.delimiter+process.env.Path:process.env.PATH=process.env.Path);process.env.PATH=n?[(0,o.getEnvBinDir)(),(0,o.getEnvDir)(),process.env.PATH].join(a.default.delimiter):process.env.PATH.split(a.default.delimiter).filter(function(e){return!e.includes((0,o.getEnvDir)())}).join(a.default.delimiter);i&&!process.env.PATH.includes(i)&&(process.env.PATH=[i,process.env.PATH].join(a.default.delimiter));process.env.Path&&(process.env.Path=process.env.PATH)},t.runCommand=h,t.processHTTPRequest=function(e,t,r){(r=r||{}).url=e,r.hasOwnProperty("headers")||(r.headers={"User-Agent":"PlatformIO"});return console.info("processHTTPRequest",r),(0,s.default)(r,function(e,r,n){return t(e,r,n)})},t.getErrorReportUrl=function(e,t){var r=!0,n=!1,o=void 0;try{for(var i,a=[["_remove_dead_weakref","https://github.com/platformio/platformio-vscode-ide/issues/142"],["Could not install 'tool-pioplus'","https://github.com/platformio/platformio-vscode-ide/issues/131"],["http://bit.ly/pio-core-virtualenv","https://github.com/platformio/platformio-vscode-ide/issues/154"],["Could not start PIO Home server: Error: timeout","https://github.com/platformio/platformio-vscode-ide/issues/205"]][Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value;if(t.includes(s[0]))return s[1]}}catch(e){n=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw o}}return"https://github.com/platformio/platformio-"+(process.env.PLATFORMIO_CALLER||"vscode")+"-ide/issues/new?"+u.default.stringify({title:encodeURIComponent(e),body:encodeURIComponent(t)})},t.isPIOProject=function(e){return i.default.isFileSync(a.default.join(e,"platformio.ini"))},t.arrayRemove=function(e,t){return e.splice(e.indexOf(t),1)},t.disposeSubscriptions=function(e){for(;e.length;)e.pop().dispose()};var o=r(4),i=l(r(2)),a=l(r(3)),u=l(r(6)),s=l(r(5)),c=l(r(13)),f=l(r(7));function l(e){return e&&e.__esModule?e:{default:e}}var p=t.IS_WINDOWS=process.platform.startsWith("win");function h(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};console.info("runCommand",e,t,n);var u=[],s=[],l=!1,h=null;if(p&&["pip","virtualenv"].some(function(r){return[a.default.basename(e)].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(t)).includes(r)})){var d=Object.assign({},process.env);h=f.default.dirSync({dir:(0,o.getCacheDir)(),unsafeCleanup:!0}).name,d.TMPDIR=d.TEMP=d.TMP=h,n.spawnOptions=n.spawnOptions||{},n.spawnOptions.env=d}try{var v=(0,c.default)(e,t,n.spawnOptions);v.stdout.on("data",function(e){return u.push(e)}),v.stderr.on("data",function(e){return s.push(e)}),v.on("close",m),v.on("error",function(e){s.push(e.toString()),m(-1)})}catch(e){s.push(e.toString()),m(-1)}function m(e){if(!l&&r){if(l=!0,h)try{i.default.removeSync(h)}catch(e){console.warn(e)}var t=u.map(function(e){return e.toString()}).join(""),n=s.map(function(e){return e.toString()}).join("");r(e,t,n)}}}function d(e){var t=["import sys",'assert sys.platform != "cygwin"','assert not sys.platform.startswith("win") or not any(s in sys.executable.lower() for s in ("msys", "mingw"))',"assert sys.version_info < (3, 0, 0)"];p?t.push("assert sys.version_info >= (2, 7, 9)"):t.push("assert sys.version_info >= (2, 7, 5)");var r=["-c",t.join(";")];return new Promise(function(t){h(e,r,function(e){t(0===e)})})}},function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHomeDir=u,t.getEnvDir=s,t.getEnvBinDir=function(){return i.default.join(s(),n.IS_WINDOWS?"Scripts":"bin")},t.getCacheDir=function(){var e=i.default.join(u(),".cache");o.default.isDirectorySync(e)||o.default.makeTreeSync(e);return e},t.getVersion=function(){return new Promise(function(e,t){(0,n.runCommand)("platformio",["--version"],function(r,n,o){if(0===r)try{return e(n.trim().match(/[\d+\.]+.*$/)[0])}catch(e){return t(e.toString())}return t(o)})})},t.runPIOCommand=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=["-f"];process.env.PLATFORMIO_CALLER&&(o.push("-c"),o.push(process.env.PLATFORMIO_CALLER));(0,n.runCommand)("platformio",[].concat(o,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(e)),t,r)};var n=r(1),o=a(r(2)),i=a(r(3));function a(e){return e&&e.__esModule?e:{default:e}}function u(){var e=n.IS_WINDOWS&&!process.env.HOME?process.env.USERPROFILE:process.env.HOME,t=process.env.PLATFORMIO_HOME_DIR||i.default.join(e||"~",".platformio");if(n.IS_WINDOWS){var r=!0,o=!1,a=void 0;try{for(var u,s=t[Symbol.iterator]();!(r=(u=s.next()).done);r=!0){if(u.value.charCodeAt(0)>127){var c=i.default.parse(t);return i.default.format({root:c.root,dir:c.root,base:".platformio",name:".platformio"})}}}catch(e){o=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw a}}}return t}function s(){return i.default.join(u(),"penv")}},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.stateStorage=t,this.onStatusChange=r,this.params=n,this._status=e.STATUS_CHECKING}return n(e,[{key:"check",value:function(){throw new Error("Stage must implement a `check` method")}},{key:"install",value:function(){throw new Error("Stage must implement an `install` method")}},{key:"destroy",value:function(){}},{key:"name",get:function(){return"Stage"}},{key:"status",get:function(){return this._status},set:function(e){this._status=e,this.onStatusChange()}},{key:"stateKey",get:function(){return this.name.toLocaleLowerCase().replace(/\s+/g,"-")}},{key:"state",get:function(){return this.stateStorage.getValue(this.stateKey)},set:function(e){this.stateStorage.setValue(this.stateKey,e)}}]),e}();o.STATUS_CHECKING=0,o.STATUS_INSTALLING=1,o.STATUS_SUCCESSED=2,o.STATUS_FAILED=3,t.default=o,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(0)),o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),a=s(r(3)),u=r(4);function s(e){return e&&e.__esModule?e:{default:e}}function c(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),u=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}}var f=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.projectDir=t,this.options=r,this.subscriptions=[],this.dirWatchSubscriptions=[],this._rebuildTimeout=void 0,this._updateDirWatchersTimeout=void 0,this._inProgress=!1,this.setupWatchers()}return o(e,[{key:"requestRebuild",value:function(){this._rebuildTimeout&&clearTimeout(this._rebuildTimeout),this._rebuildTimeout=setTimeout(this.rebuild.bind(this),e.AUTO_REBUILD_DELAY)}},{key:"rebuild",value:function(){var e=this;if(!this._inProgress&&(0,i.isPIOProject)(this.projectDir))return this.options.withProgress(c(n.default.mark(function t(){return n.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e._inProgress=!0,t.prev=1,t.next=4,new Promise(function(t,r){(0,u.runPIOCommand)(["init","--ide",e.options.ide,"--project-dir",e.projectDir],function(e,n,o){0===e?t():r(o)})});case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),console.warn(t.t0);case 9:e._inProgress=!1;case 10:case"end":return t.stop()}},t,e,[[1,6]])})))}},{key:"setupWatchers",value:function(){var e=this,t=this.options.createFileSystemWatcher(a.default.join(this.projectDir,"platformio.ini"));this.subscriptions.push(t,t.onDidCreate(function(){e.requestRebuild(),e.requestUpdateDirWatchers()}),t.onDidChange(function(){e.requestRebuild(),e.requestUpdateDirWatchers()}),t.onDidDelete(function(){return e.updateDirWatchers()})),this.requestUpdateDirWatchers()}},{key:"requestUpdateDirWatchers",value:function(){this._updateDirWatchersTimeout&&clearTimeout(this._updateDirWatchersTimeout),this._updateDirWatchersTimeout=setTimeout(this.updateDirWatchers.bind(this),3*e.AUTO_REBUILD_DELAY)}},{key:"updateDirWatchers",value:function(){var e=c(n.default.mark(function e(){var t=this;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((0,i.disposeSubscriptions)(this.dirWatchSubscriptions),(0,i.isPIOProject)(this.projectDir)){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this.fetchWatchDirs();case 6:e.t0=function(e){var r=t.options.createDirSystemWatcher(e);t.dirWatchSubscriptions.push(r,r.onDidCreate(function(){return t.requestRebuild()}),r.onDidChange(function(){return t.requestRebuild()}),r.onDidDelete(function(){return t.requestRebuild()}))},e.sent.forEach(e.t0),e.next=13;break;case 10:e.prev=10,e.t1=e.catch(3),console.warn(e.t1);case 13:case"end":return e.stop()}},e,this,[[3,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"fetchWatchDirs",value:function(){var t=c(n.default.mark(function t(){var r,o=this;return n.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.PythonExecutable){t.next=4;break}return t.next=3,(0,i.getPythonExecutable)(this.options.useBuiltinPIOCore);case 3:e.PythonExecutable=t.sent;case 4:return r=["from os.path import join","from platformio import util",'print(":".join([join(util.get_home_dir(), "lib"), util.get_projectlib_dir(), util.get_projectlibdeps_dir()]))'],t.abrupt("return",new Promise(function(t,n){(0,i.runCommand)(e.PythonExecutable,["-c",r.join(";")],function(e,r,o){0===e?t(r.toString().trim().split(":")):n(o)},{spawnOptions:{cwd:o.projectDir}})}));case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"dispose",value:function(){(0,i.disposeSubscriptions)(this.dirWatchSubscriptions),(0,i.disposeSubscriptions)(this.subscriptions),this._rebuildTimeout&&clearTimeout(this._rebuildTimeout),this._updateDirWatchersTimeout&&clearTimeout(this._updateDirWatchersTimeout)}}]),e}();f.AUTO_REBUILD_DELAY=3e3,t.default=f,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.misc=t.project=t.installer=t.home=t.core=void 0;var n=p(r(4)),o=p(r(14)),i=p(r(1)),a=l(r(8)),u=l(r(18)),s=l(r(9)),c=l(r(23)),f=l(r(24));function l(e){return e&&e.__esModule?e:{default:e}}function p(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var h={BaseStage:a.default,PlatformIOCoreStage:u.default},d={ProjectIndexer:s.default,ProjectObserver:c.default,ProjectTasks:f.default};t.core=n,t.home=o,t.installer=h,t.project=d,t.misc=i},function(e,t,r){var n=function(){return this}()||Function("return this")(),o=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,i=o&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=r(12),o)n.regeneratorRuntime=i;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var r,n=Object.prototype,o=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag",c="object"==typeof e,f=t.regeneratorRuntime;if(f)c&&(e.exports=f);else{(f=t.regeneratorRuntime=c?e.exports:{}).wrap=w;var l="suspendedStart",p="suspendedYield",h="executing",d="completed",v={},m={};m[a]=function(){return this};var y=Object.getPrototypeOf,g=y&&y(y(D([])));g&&g!==n&&o.call(g,a)&&(m=g);var b=_.prototype=P.prototype=Object.create(m);k.prototype=b.constructor=_,_.constructor=k,_[s]=k.displayName="GeneratorFunction",f.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===k||"GeneratorFunction"===(t.displayName||t.name))},f.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(b),e},f.awrap=function(e){return{__await:e}},S(O.prototype),O.prototype[u]=function(){return this},f.AsyncIterator=O,f.async=function(e,t,r,n){var o=new O(w(e,t,r,n));return f.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},S(b),b[s]="Generator",b[a]=function(){return this},b.toString=function(){return"[object Generator]"},f.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},f.values=D,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,o){return u.type="throw",u.arg=e,t.next=n,o&&(t.method="next",t.arg=r),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:D(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),v}}}function w(e,t,r,n){var o=t&&t.prototype instanceof P?t:P,i=Object.create(o.prototype),a=new I(n||[]);return i._invoke=function(e,t,r){var n=l;return function(o,i){if(n===h)throw new Error("Generator is already running");if(n===d){if("throw"===o)throw i;return j()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=E(a,r);if(u){if(u===v)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=d,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=h;var s=x(e,t,r);if("normal"===s.type){if(n=r.done?d:p,s.arg===v)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n=d,r.method="throw",r.arg=s.arg)}}}(e,r,a),i}function x(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function P(){}function k(){}function _(){}function S(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function O(e){var t;this._invoke=function(r,n){function i(){return new Promise(function(t,i){!function t(r,n,i,a){var u=x(e[r],e,n);if("throw"!==u.type){var s=u.arg,c=s.value;return c&&"object"==typeof c&&o.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,i,a)},function(e){t("throw",e,i,a)}):Promise.resolve(c).then(function(e){s.value=e,i(s)},a)}a(u.arg)}(r,n,t,i)})}return t=t?t.then(i,i):i()}}function E(e,t){var n=e.iterator[t.method];if(n===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=r,E(e,t),"throw"===t.method))return v;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var o=x(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,v;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,v):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(o.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=r,t.done=!0,t};return i.next=i}}return{next:j}}function j(){return{value:r,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t){e.exports=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ensureServerStarted=void 0;var n=d(r(0)),o=function(){var e=v(n.default.mark(function e(){var t;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=8010,!1;case 2:if(!(t<9e3)){e.next=11;break}return e.next=5,new Promise(function(e){h.default.check(t,y).then(function(t){e(t)},function(){return e(!1)})});case 5:if(e.sent){e.next=8;break}return e.abrupt("return",t);case 8:t++,e.next=2;break;case 11:return e.abrupt("return",0);case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),i=(t.ensureServerStarted=function(){var e=v(n.default.mark(function e(){var t,r,o,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=3,r=0,o=void 0;case 3:if(!(r<t)){e.next=18;break}return e.prev=4,e.next=7,i(a);case 7:return e.abrupt("return",e.sent);case 10:e.prev=10,e.t0=e.catch(4),o=e.t0,console.warn(e.t0),g=0;case 15:r++,e.next=3;break;case 18:throw o;case 19:case"end":return e.stop()}},e,this,[[4,10]])}));return function(){return e.apply(this,arguments)}}(),function(){var e=v(n.default.mark(function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==g){e.next=4;break}return e.next=3,o();case 3:g=e.sent;case 4:return t={host:y,port:g},e.next=7,x();case 7:if(e.sent){e.next=10;break}return e.next=10,new Promise(function(e,t){(0,a.runPIOCommand)(["home","--port",g,"--no-open"],function(e,r,n){if(0!==e)return g=0,t(n)}),h.default.waitUntilUsed(g,500,1e3*m).then(function(){e(!0)},function(e){t("Could not start PIO Home server: "+e.toString())})});case 10:return r.onIDECommand&&w(r.onIDECommand),e.abrupt("return",t);case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}());t.isServerStarted=x,t.shutdownServer=function(){if(!g)return;return p.default.get("http://"+y+":"+g+"?__shutdown__=1")},t.loadState=P,t.showAtStartup=function(e){var t=P();return!t||!t.storage||!t.storage.showOnStartup||!t.storage.showOnStartup.hasOwnProperty(e)||t.storage.showOnStartup[e]},t.getFrontendUri=function(e,t,r){var n=(P()||{}).storage||{},o={start:r.start||"/",theme:n.theme||r.theme,workspace:n.workspace||r.workspace};return Object.keys(o).forEach(function(e){[void 0,null].includes(o[e])&&delete o[e]}),"http://"+e+":"+t+"?"+l.default.stringify(o)};var a=r(4),u=d(r(15)),s=d(r(2)),c=d(r(16)),f=d(r(3)),l=d(r(6)),p=d(r(5)),h=d(r(17));function d(e){return e&&e.__esModule?e:{default:e}}function v(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),u=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}}var m=300,y="127.0.0.1",g=0,b=0;function w(e){if(!(b>0)){var t={timer:null,delay:500,maxDelay:1e4,retries:0};!function(r){t.timer&&clearTimeout(t.timer);var n=new u.default(r);n.onopen=function(){b=1,t.retries=0,n.send(JSON.stringify(c.default.request(Math.random().toString(),"ide.listen_commands")))},n.onclose=function(){b=0},n.onmessage=function(t){try{var r=c.default.parse(t.data);switch(r.type){case"success":e(r.payload.result.method,r.payload.result.params);break;case"error":console.error("Errored result: "+r.payload.toString())}}catch(e){console.error("Invalid RPC message: "+e.toString())}n.send(JSON.stringify(c.default.request(Math.random().toString(),"ide.listen_commands")))}}("http://"+y+":"+g+"/wsrpc")}}function x(){return new Promise(function(e){h.default.check(g,y).then(function(t){e(t)},function(){return e(!1)})})}function P(){var e=f.default.join((0,a.getHomeDir)(),"homestate.json");if(!s.default.isFileSync(e))return null;try{return JSON.parse(s.default.readFileSync(e,"utf8"))}catch(e){return console.warn(e),null}}},function(e,t){e.exports=a},function(e,t){e.exports=u},function(e,t){e.exports=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=h(r(0)),o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(4)),a=r(1),u=r(19),s=h(r(8)),c=h(r(2)),f=h(r(3)),l=h(r(22)),p=h(r(7));function h(e){return e&&e.__esModule?e:{default:e}}function d(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function v(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),u=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}}var m=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return p.default.setGracefulCleanup(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"whereIsPython",value:function(){var e=v(n.default.mark(function e(){var t,r,o;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.params.pythonPrompt.STATUS_TRY_AGAIN;case 1:return e.next=3,(0,a.getPythonExecutable)(this.params.useBuiltinPIOCore);case 3:if(!(r=e.sent)){e.next=6;break}return e.abrupt("return",r);case 6:if(!process.platform.startsWith("win")){e.next=16;break}return e.prev=7,e.next=10,this.installPythonForWindows();case 10:return e.abrupt("return",e.sent);case 13:e.prev=13,e.t0=e.catch(7),console.warn(e.t0);case 16:return e.next=18,this.params.pythonPrompt.prompt();case 18:if(o=e.sent,(t=o.status)!==this.params.pythonPrompt.STATUS_CUSTOMEXE){e.next=22;break}return e.abrupt("return",o.pythonExecutable);case 22:if(t!==this.params.pythonPrompt.STATUS_ABORT){e.next=1;break}case 23:throw this.status=s.default.STATUS_FAILED,new Error("Can not find Python Interpreter");case 25:case"end":return e.stop()}},e,this,[[7,13]])}));return function(){return e.apply(this,arguments)}}()},{key:"installPythonForWindows",value:function(){var e=v(n.default.mark(function e(){var r,o,s,l,p;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="x64"===process.arch?".amd64":"",o="https://www.python.org/ftp/python/"+t.pythonVersion+"/python-"+t.pythonVersion+r+".msi",e.next=4,(0,u.download)(o,f.default.join(i.getCacheDir(),f.default.basename(o)));case 4:if(s=e.sent,l=f.default.join(i.getHomeDir(),"python27"),p=f.default.join(l,"python.exe"),c.default.isFileSync(p)){e.next=18;break}return e.prev=8,e.next=11,this.installPythonFromWindowsMSI(s,l);case 11:e.next=18;break;case 13:return e.prev=13,e.t0=e.catch(8),console.warn(e.t0),e.next=18,this.installPythonFromWindowsMSI(s,l,!0);case 18:return process.env.PATH=[l,f.default.join(l,"Scripts"),process.env.PATH].join(f.default.delimiter),process.env.Path=process.env.PATH,e.abrupt("return",new Promise(function(e){(0,a.runCommand)("pip",["install","virtualenv"],function(){return e(p)})}));case 21:case"end":return e.stop()}},e,this,[[8,13]])}));return function(){return e.apply(this,arguments)}}()},{key:"installPythonFromWindowsMSI",value:function(){var e=v(n.default.mark(function e(t,r){var o,u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=f.default.join(i.getCacheDir(),"python27msi.log"),e.next=3,new Promise(function(e,n){(0,a.runCommand)("msiexec.exe",[u?"/a":"/i",'"'+t+'"',"/qn","/li",'"'+o+'"','TARGETDIR="'+r+'"'],function(t,r,i){return 0===t?e(r):(c.default.isFileSync(o)&&(i=c.default.readFileSync(o).toString()),n("MSI Python2.7: "+i))},{spawnOptions:{shell:!0}})});case 3:if(c.default.isFileSync(f.default.join(r,"python.exe"))){e.next=5;break}throw new Error("Could not install Python 2.7 using MSI");case 5:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"cleanVirtualEnvDir",value:function(){var e=i.getEnvDir();if(!c.default.isDirectorySync(e))return!0;try{return c.default.removeSync(e),!0}catch(e){return console.warn(e),!1}}},{key:"isCondaInstalled",value:function(){return new Promise(function(e){(0,a.runCommand)("conda",["--version"],function(t){return e(0===t)})})}},{key:"createVirtualenvWithConda",value:function(){return this.cleanVirtualEnvDir(),new Promise(function(e,t){(0,a.runCommand)("conda",["create","--yes","--quiet","python=2","pip","--prefix",i.getEnvDir()],function(r,n,o){return 0===r?e(n):t("Conda Virtualenv: "+o)})})}},{key:"createVirtualenvWithLocal",value:function(){var e=v(n.default.mark(function e(t){var r;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,this.cleanVirtualEnvDir(),e.prev=2,e.next=5,new Promise(function(e,r){(0,a.runCommand)(t,["-m","virtualenv","-p",t,i.getEnvDir()],function(t,n,o){return 0===t?e(n):r("User's Virtualenv: "+o)})});case 5:r=e.sent,e.next=14;break;case 8:return e.prev=8,e.t0=e.catch(2),this.cleanVirtualEnvDir(),e.next=13,new Promise(function(e,r){(0,a.runCommand)("virtualenv",["-p",t,i.getEnvDir()],function(t,n,o){return 0===t?e(n):r("User's Virtualenv: "+o)})});case 13:r=e.sent;case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}},e,this,[[2,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"createVirtualenvWithDownload",value:function(){var e=v(n.default.mark(function e(r){var o,s,l,h;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.cleanVirtualEnvDir(),e.next=3,(0,u.download)(t.virtualenvUrl,f.default.join(i.getCacheDir(),"virtualenv.tar.gz"));case 3:return o=e.sent,s=p.default.dirSync({dir:i.getCacheDir(),unsafeCleanup:!0}).name,e.next=7,(0,u.extractTarGz)(o,s);case 7:if(l=e.sent,h=c.default.listTreeSync(l).find(function(e){return"virtualenv.py"===f.default.basename(e)})){e.next=11;break}throw new Error("Can not find virtualenv.py script");case 11:return e.abrupt("return",new Promise(function(e,t){(0,a.runCommand)(r,[h,i.getEnvDir()],function(r,n,o){try{c.default.removeSync(s)}catch(e){console.warn(e)}if(0===r)return e(n);var i="Virtualenv Create: "+o;return o.includes("WindowsError: [Error 5]")&&(i="If you use Antivirus, it can block PlatformIO Installer. Try to disable it for a while.\n\n"+i),t(i)})}));case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"installVirtualenvPackage",value:function(e){return new Promise(function(t,r){(0,a.runCommand)(e,["-m","pip","install","virtualenv"],function(e,n,o){return 0===e?t(n):r("Install Virtualenv globally: "+o)})})}},{key:"createVirtualenv",value:function(){var e=v(n.default.mark(function e(){var t;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.isCondaInstalled();case 2:if(!e.sent){e.next=6;break}return e.next=5,this.createVirtualenvWithConda();case 5:return e.abrupt("return",e.sent);case 6:return e.next=8,this.whereIsPython();case 8:return t=e.sent,e.prev=9,e.next=12,this.createVirtualenvWithLocal(t);case 12:e.next=36;break;case 14:return e.prev=14,e.t0=e.catch(9),console.warn(e.t0),e.prev=17,e.next=20,this.createVirtualenvWithDownload(t);case 20:e.next=36;break;case 22:return e.prev=22,e.t1=e.catch(17),console.warn(e.t1),e.prev=25,e.next=28,this.installVirtualenvPackage(t);case 28:return e.next=30,this.createVirtualenvWithLocal(t);case 30:e.next=36;break;case 32:throw e.prev=32,e.t2=e.catch(25),console.warn(e.t2),new Error("Could not create PIO Core Virtual Environment. Please create it manually -> http://bit.ly/pio-core-virtualenv");case 36:case"end":return e.stop()}},e,this,[[9,14],[17,22],[25,32]])}));return function(){return e.apply(this,arguments)}}()},{key:"upgradePIP",value:function(){var e=v(n.default.mark(function e(r){var o;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.download)(t.pipUrl,f.default.join(i.getCacheDir(),f.default.basename(t.pipUrl)));case 2:return o=e.sent,e.abrupt("return",new Promise(function(e){(0,a.runCommand)(r,["-m","pip","install","-U",o],function(t,r,n){0!==t&&console.warn(n),e(!0)})}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"installPIOCore",value:function(){var e=v(n.default.mark(function e(){var r,o;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.whereIsPython();case 2:return r=e.sent,e.next=5,this.upgradePIP(r);case 5:return o=["-m","pip","install","-U"],this.params.useDevelopmentPIOCore?o.push(t.pioCoreDevelopUrl):o.push("platformio"),e.abrupt("return",new Promise(function(e,t){(0,a.runCommand)(r,o,function(r,n,o){0===r?e(n):(a.IS_WINDOWS&&(o+="\n If you have antivirus software in a system, try to disable it for a while."),t("PIP: "+o))})}));case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"installPIOHome",value:function(){return new Promise(function(e){i.runPIOCommand(["home","--host","__do_not_start__"],function(t,r,n){return 0!==t&&console.warn(r,n),e(!0)})})}},{key:"initState",value:function(){var e=this.state;return e&&e.hasOwnProperty("pioCoreChecked")&&e.hasOwnProperty("lastIDEVersion")||(e={pioCoreChecked:0,lastIDEVersion:null}),e}},{key:"autoUpgradePIOCore",value:function(){var e=v(n.default.mark(function e(r){var o,a,u=this;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.initState(),a=(new Date).getTime(),!(process.env.PLATFORMIO_IDE&&o.lastIDEVersion&&o.lastIDEVersion!==process.env.PLATFORMIO_IDE||a-t.UPGRADE_PIOCORE_TIMEOUT>parseInt(o.pioCoreChecked))){e.next=6;break}return o.pioCoreChecked=a,e.next=6,new Promise(function(e){i.runPIOCommand(["upgrade"].concat(d(u.params.useDevelopmentPIOCore&&!l.default.prerelease(r)?["--dev"]:[])),function(t,r,n){0!==t&&console.warn(r,n),e(!0)})});case 6:o.lastIDEVersion=process.env.PLATFORMIO_IDE,this.state=o;case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"check",value:function(){var e=v(n.default.mark(function e(){var t;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=u.PEPverToSemver,e.next=3,i.getVersion();case 3:if(e.t1=e.sent,t=(0,e.t0)(e.t1),!this.params.useBuiltinPIOCore){e.next=20;break}if(c.default.isDirectorySync(i.getEnvBinDir())){e.next=10;break}throw new Error("Virtual environment is not created");case 10:if(!l.default.lt(t,"3.5.0-rc.4")){e.next=12;break}throw new Error("Force new python environment");case 12:return e.prev=12,e.next=15,this.autoUpgradePIOCore(t);case 15:e.next=20;break;case 17:e.prev=17,e.t2=e.catch(12),console.warn(e.t2);case 20:if(!l.default.lt(t,this.params.pioCoreMinVersion)){e.next=25;break}throw this.params.setUseBuiltinPIOCore(!0),this.params.useBuiltinPIOCore=!0,this.params.useDevelopmentPIOCore=this.params.useDevelopmentPIOCore||l.default.prerelease(this.params.pioCoreMinVersion),new Error("Incompatible PIO Core "+t);case 25:return this.status=s.default.STATUS_SUCCESSED,console.info("Found PIO Core "+t),e.abrupt("return",!0);case 28:case"end":return e.stop()}},e,this,[[12,17]])}));return function(){return e.apply(this,arguments)}}()},{key:"install",value:function(){var e=v(n.default.mark(function e(){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.status!==s.default.STATUS_SUCCESSED){e.next=2;break}return e.abrupt("return",!0);case 2:if(this.params.useBuiltinPIOCore){e.next=5;break}return this.status=s.default.STATUS_SUCCESSED,e.abrupt("return",!0);case 5:return this.status=s.default.STATUS_INSTALLING,e.next=8,this.createVirtualenv();case 8:return e.next=10,this.installPIOCore();case 10:return e.next=12,this.installPIOHome();case 12:return this.status=s.default.STATUS_SUCCESSED,e.abrupt("return",!0);case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"name",get:function(){return"PlatformIO Core"}}]),t}();m.UPGRADE_PIOCORE_TIMEOUT=6048e5,m.pythonVersion="2.7.13",m.virtualenvUrl="https://pypi.python.org/packages/source/v/virtualenv/virtualenv-16.0.0.tar.gz",m.pioCoreDevelopUrl="https://github.com/platformio/platformio/archive/develop.zip",m.pipUrl="https://files.pythonhosted.org/packages/69/81/52b68d0a4de760a2f1979b0931ba7889202f302072cc7a0d614211bc7579/pip-18.0.tar.gz",t.default=m,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.download=void 0;var n=f(r(0)),o=(t.download=function(){var e=l(n.default.mark(function e(t,r){var i,a,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(t);case 2:if(i=e.sent,!p(r,i)){e.next=5;break}return e.abrupt("return",r);case 5:a="";case 6:if(!(u>=0)){e.next=21;break}return e.prev=7,e.next=10,o(t,r);case 10:if(!p(r,i)){e.next=12;break}return e.abrupt("return",r);case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(7),a=e.t0,console.warn(e.t0);case 18:u--,e.next=6;break;case 21:throw new Error("Failed to download file "+t+": "+a);case 22:case"end":return e.stop()}},e,this,[[7,14]])}));return function(t,r){return e.apply(this,arguments)}}(),function(){var e=l(n.default.mark(function e(t,r){var o,s;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=null,e.prev=1,s=atom.packages.getApmPath(),e.next=5,new Promise(function(e,t){(0,u.runCommand)(s,["--no-color","config","get","https-proxy"],function(r,n){if(0!==r)return t(null);e("null"===n.trim()?null:n.trim())})});case 5:o=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),o=process.env.HTTPS_PROXY&&process.env.HTTPS_PROXY.trim()||process.env.HTTP_PROXY&&process.env.HTTP_PROXY.trim();case 11:return e.abrupt("return",new Promise(function(e,n){var u=i.default.createWriteStream(r),s={url:t};o&&(s.proxy=o),a.default.get(s).on("error",function(e){return n(e)}).pipe(u),u.on("error",function(e){return n(e)}),u.on("finish",function(){return e(r)})}));case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}());t.extractTarGz=function(e,t){return new Promise(function(r,n){i.default.createReadStream(e).pipe(c.default.createGunzip()).on("error",function(e){return n(e)}).pipe(s.default.extract({cwd:t})).on("error",function(e){return n(e)}).on("close",function(){return r(t)})})},t.PEPverToSemver=function(e){return e.replace(/(\.\d+)\.?(dev|a|b|rc|post)/,"$1-$2.")};var i=f(r(2)),a=f(r(5)),u=r(1),s=f(r(20)),c=f(r(21));function f(e){return e&&e.__esModule?e:{default:e}}function l(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),u=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}}function p(e,t){if(i.default.isFileSync(e)){if(t>0&&t==i.default.getSizeSync(e))return!0;try{i.default.removeSync(e)}catch(e){console.warn(e)}}return!1}function h(e){return new Promise(function(t){a.default.head({url:e},function(e,r){!e&&200===r.statusCode&&r.headers.hasOwnProperty("content-length")||t(-1),t(parseInt(r.headers["content-length"]))})})}},function(e,t){e.exports=c},function(e,t){e.exports=f},function(e,t){e.exports=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(0)),o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=u(r(9)),a=r(1);function u(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,this._indexers=[]}return o(e,[{key:"update",value:function(){var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),u=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}}(n.default.mark(function e(t){var r,o,a,u,s,c,f,l=this;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._indexers=this._indexers.filter(function(e){return!!t.includes(e.projectDir)||(e.dispose(),!1)}),r=n.default.mark(function e(t){var r;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!l._indexers.some(function(e){return e.projectDir===t})){e.next=2;break}return e.abrupt("return","continue");case 2:return r=new i.default(t,l.options),l._indexers.push(r),e.next=6,r.rebuild();case 6:case"end":return e.stop()}},e,l)}),o=!0,a=!1,u=void 0,e.prev=5,s=t[Symbol.iterator]();case 7:if(o=(c=s.next()).done){e.next=16;break}return f=c.value,e.delegateYield(r(f),"t0",10);case 10:if("continue"!==e.t0){e.next=13;break}return e.abrupt("continue",13);case 13:o=!0,e.next=7;break;case 16:e.next=22;break;case 18:e.prev=18,e.t1=e.catch(5),a=!0,u=e.t1;case 22:e.prev=22,e.prev=23,!o&&s.return&&s.return();case 25:if(e.prev=25,!a){e.next=28;break}throw u;case 28:return e.finish(25);case 29:return e.finish(22);case 30:case"end":return e.stop()}},e,this,[[5,18,22,30],[23,,25,29]])}));return function(t){return e.apply(this,arguments)}}()},{key:"rebuildIndex",value:function(){this._indexers.forEach(function(e){return e.rebuild()})}},{key:"dispose",value:function(){(0,a.disposeSubscriptions)(this._indexers)}}]),e}();t.default=s,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(0)),o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=s(r(2)),a=s(r(25)),u=s(r(3));function s(e){return e&&e.__esModule?e:{default:e}}function c(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=function(){function e(t,r){f(this,e),this.projectDir=t,this.ide=r}return o(e,[{key:"taskCompatibleWithPlatform",value:function(e,t){return!(e.args.includes("program")&&!t.includes("atmelavr"))&&!(e.args.includes("uploadfs")&&!t.includes("espressif"))}},{key:"getTasks",value:function(){var t=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),u=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}}(n.default.mark(function t(){var r,o,s,f,l,h,d,v,m,y,g,b=this;return n.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.projectDir){t.next=2;break}return t.abrupt("return",[]);case 2:return r=[],o=void 0,t.prev=4,t.next=7,new Promise(function(e,t){i.default.readFile(u.default.join(b.projectDir,"platformio.ini"),"utf-8",function(r,n){return r?t(r):e(n)})});case 7:s=t.sent,o=a.default.parse(s),t.next=15;break;case 11:return t.prev=11,t.t0=t.catch(4),console.warn('Could not parse "platformio.ini" file in '+this.projectDir),t.abrupt("return",r);case 15:f=[],l=!0,h=!1,d=void 0,t.prev=19,v=Object.keys(o)[Symbol.iterator]();case 21:if(l=(m=v.next()).done){t.next=30;break}if(y=m.value,(g=o[y].platform)&&y.startsWith(e.ENV_NAME_PREFIX)){t.next=26;break}return t.abrupt("continue",27);case 26:f.push({env:y.slice(e.ENV_NAME_PREFIX.length),platform:g});case 27:l=!0,t.next=21;break;case 30:t.next=36;break;case 32:t.prev=32,t.t1=t.catch(19),h=!0,d=t.t1;case 36:t.prev=36,t.prev=37,!l&&v.return&&v.return();case 39:if(t.prev=39,!h){t.next=42;break}throw d;case 42:return t.finish(39);case 43:return t.finish(36);case 44:return e.baseTasks.forEach(function(e){f.some(function(t){return b.taskCompatibleWithPlatform(e,t.platform)})&&r.push(new p(e.name,e.description,e.args.slice(0)))}),f.length>1&&f.forEach(function(t){e.baseTasks.forEach(function(e){b.taskCompatibleWithPlatform(e,t.platform)&&r.push(new p(e.name,e.description,[].concat(c(e.args.slice(0)),["--environment",t.env])))})}),r.push(new p("Update project libraries",void 0,["lib","update"])),r.push(new p("Rebuild IntelliSense Index",void 0,["init","--ide",this.ide])),t.abrupt("return",r);case 49:case"end":return t.stop()}},t,this,[[4,11],[19,32,36,44],[37,,39,43]])}));return function(){return t.apply(this,arguments)}}()}]),e}();l.ENV_NAME_PREFIX="env:",l.baseTasks=[{name:"Build",args:["run"]},{name:"Upload",args:["run","--target","upload"]},{name:"Clean",args:["run","--target","clean"]},{name:"Verbose Build",args:["run","--verbose"]},{name:"Verbose Upload",args:["run","--verbose","--target","upload"]},{name:"Upload and Monitor",args:["run","--target","upload","--target","monitor"]},{name:"Upload using Programmer",args:["run","--target","program"]},{name:"Upload File System image",args:["run","--target","uploadfs"]},{name:"Monitor",args:["device","monitor"]},{name:"Test",args:["test"]},{name:"Remote",args:["remote","run","--target","upload"]},{name:"Pre-Debug",description:"build in debug mode",args:["debug"]}],t.default=l;var p=function(){function e(t,r,n){f(this,e),this.name=t,this.description=r,this.args=n}return o(e,[{key:"isBuild",value:function(){return this.name.startsWith("Build")}},{key:"isClean",value:function(){return this.name.startsWith("Clean")}},{key:"isTest",value:function(){return this.name.startsWith("Test")}},{key:"coreTarget",get:function(){if("run"!==this.args[0])return this.args[0];var e=this.args.indexOf("--target");return-1!==e?this.args[e+1]:"build"}},{key:"coreEnv",get:function(){var e=this.args.indexOf("--environment");return-1!==e?this.args[e+1]:void 0}},{key:"id",get:function(){var e=this.name;return this.coreEnv&&(e+=" ("+this.coreEnv+")"),e}},{key:"title",get:function(){return this.description?this.id+" ["+this.description+"]":this.id}}]),e}();e.exports=t.default},function(e,t){e.exports=p}])});